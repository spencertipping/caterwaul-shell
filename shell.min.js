caterwaul.module("shell",function(a){a.shell=function(){return jQuery("<input>").addClass("caterwaul-shell").modus(a.shell.val,a.shell.val).on("keydown keypress keyup",a.shell.handle_interaction)},a.merge(a.shell,function(){var b=a(":all"),c=function(b){return b?a(this).data("caterwaul-shell-state",b).modus("val",b.text_).caret(b.selection_range_):construct_state(a(this).data("caterwaul-shell-state")||{})},d=function(a){return new e(a.history_||[],a.values_||[],a.text_||"",a.selection_range_||{start:0,end:0},a.context_||window,a.compiler_||b)},e=function(b){return a.merge(b.prototype,{is_valid:function(){return function(){try{return this.compiler_.parse(this.text_),!0}catch(a){return!1}}.call(this)},modify:function(b){return d(a.merge({},this,b))},accept:function(a){return this.modify({text_:this.text_+String.fromCharCode(a),selection_range_:{start:this.selection_range_.start+1,end:this.selection_range_.start+1}})},evaluate:function(){return d({values_:this.values_.concat([function(){try{return{value:this.compiler_(this.text_,this.context_)}}catch(a){return{error:a}}}.call(this)]),history_:this.history_.concat([this.text_]),context_:this.context_,compiler_:this.compiler_})}}),b}.call(this,function(a,b,c,d,e,f,g){return this.history_=a,this.values_=b,this.text_=d,this.selection_range_=e,this.context_=f,this.compiler_=g,null}),f=function(a){var b=jQuery(this);return b.val(g.call(b,b.val(),a))},g=function(a,b){return b.type==="keypress"?b.which===13?a.evaluate():a.accept(b.which):a};return{compiler:b,val:c,state:d,state_ctor:e,handle_interaction:f,interact:g}}.call(this))});